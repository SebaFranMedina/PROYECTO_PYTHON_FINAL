{% extends "base.html" %}
{% block content %}
<br>
{% if request.query_params.get('error') %}
<div class="alert alert-danger text-center">
    {{ request.query_params.get('error') }}
</div>
{% endif %}

<h2 class="mb-4 text-center">Listado de Autores</h2>

<div class="mb-3 text-end">
    <a href="/autores/create" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> Nuevo Autor
    </a>
</div>

<style>
  /* Altura fija para el encabezado */
  #tabla-autores thead tr th {
    height: 60px;
    vertical-align: middle;
  }
  /* Ancho fijo para la columna Acciones */
  #tabla-autores thead tr th:last-child,
  #tabla-autores tbody tr td:last-child {
    width: 200px;
    white-space: nowrap;
  }
</style>

<table id="tabla-autores" class="table table-striped table-hover table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Fecha de Nacimiento</th>
            <th>Nacionalidad</th>
            <th>Biografía</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    {% for autor in autores %}
        <tr>
            <td>{{ autor.nombre }}</td>
            <td>{{ autor.apellido }}</td>
            <td>{{ autor.fecha_nacimiento.strftime('%Y-%m-%d') if autor.fecha_nacimiento else '' }}</td>
            <td>{{ autor.nacionalidad.sdes if autor.nacionalidad else '' }}</td>
            <td>{{ autor.biografia[:100] ~ ("..." if autor.biografia and autor.biografia|length > 100 else "") if autor.biografia else "" }}</td>
            <td>
                <a href="/autores/{{ autor.autor_id }}" class="btn btn-sm btn-outline-primary me-1">
                    <i class="bi bi-pencil"></i> Editar
                </a>
                <form method="post" action="/api/autores/{{ autor.autor_id }}/eliminar" 
                      class="d-inline me-1"
                      onsubmit="return confirm('¿Estás seguro que querés eliminar este autor?');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </form>
                <!-- Botón Wikipedia -->
                <a href="/autores/{{ autor.autor_id }}/wiki" class="btn btn-sm btn-info" target="_blank">
                    <i class="bi bi-info-circle"></i> Wikipedia
                </a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Activar DataTables -->
<script>
  $(document).ready(function() {
      $('#tabla-autores').DataTable({
          "language": {
              "search": "Filtrar:",
              "lengthMenu": "Mostrar _MENU_ autores por página",
              "zeroRecords": "No se encontraron autores",
              "info": "Mostrando _START_ a _END_ de _TOTAL_ autores",
              "infoEmpty": "No hay autores disponibles",
              "infoFiltered": "(filtrado de _MAX_ autores en total)",
          },
          "pagingType": "simple_numbers"
      });
  });
</script>
{% endblock %}
